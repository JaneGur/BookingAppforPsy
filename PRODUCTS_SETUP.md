# ๐ ะะฐัััะพะนะบะฐ ัะธััะตะผั ะฟัะพะดัะบัะพะฒ ะธ ัะบะธะดะพะบ

## ะจะฐะณ 1: ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะธ ะะ

ะัะบัะพะนัะต **Supabase SQL Editor** ะธ ะฒัะฟะพะปะฝะธัะต ะผะธะณัะฐัะธั:

```sql
-- ะกะบะพะฟะธััะนัะต ัะพะดะตัะถะธะผะพะต ัะฐะนะปะฐ:
-- supabase/migrations/add_product_discounts.sql
```

ะะปะธ ะฒัะฟะพะปะฝะธัะต ะฝะฐะฟััะผัั:

```sql
-- ะะพะฑะฐะฒะปัะตะผ ะฝะพะฒัะต ะฟะพะปั ะดะปั ัะบะธะดะพะบ
ALTER TABLE public.products 
ADD COLUMN IF NOT EXISTS discount_percent integer check (discount_percent >= 0 and discount_percent <= 100),
ADD COLUMN IF NOT EXISTS has_special_categories_discount boolean not null default false,
ADD COLUMN IF NOT EXISTS bulk_discount_threshold integer check (bulk_discount_threshold > 0),
ADD COLUMN IF NOT EXISTS bulk_discount_percent integer check (bulk_discount_percent >= 0 and bulk_discount_percent <= 100),
ADD COLUMN IF NOT EXISTS promo_text text;

-- ะกะพะทะดะฐะตะผ ะธะฝะดะตะบั
CREATE INDEX IF NOT EXISTS products_with_discounts_idx 
ON public.products (is_active) 
WHERE discount_percent > 0 OR has_special_categories_discount = true OR bulk_discount_percent > 0;

-- ะกะพะทะดะฐะตะผ ัะตััะพะฒัะต ะฟัะพะดัะบัั
INSERT INTO public.products (
  name, sku, description, price_rub, is_active, is_package, sessions_count,
  sort_order, is_featured, discount_percent, has_special_categories_discount,
  bulk_discount_threshold, bulk_discount_percent, promo_text
) VALUES 
  (
    'ะะดะฝะฐ ะบะพะฝััะปััะฐัะธั',
    'SINGLE',
    'ะะฐะทะพะฒะฐั ัะตััะธั ะฐัั-ัะตัะฐะฟะธะธ ะดะปะธัะตะปัะฝะพัััั 60 ะผะธะฝัั',
    5000, true, false, 1, 1, true, 0, true, NULL, NULL, NULL
  ),
  (
    'ะะฐะบะตั 5 ะบะพะฝััะปััะฐัะธะน',
    'PACK_5',
    '5 ัะตััะธะน ัะพ ัะบะธะดะบะพะน. ะญะบะพะฝะพะผะธั 2500โฝ',
    22500, true, true, 5, 2, false, 10, true, NULL, NULL, 'ะกะบะธะดะบะฐ 10% ะฝะฐ ะฟะฐะบะตั!'
  ),
  (
    'ะะฐะบะตั 10 ะบะพะฝััะปััะฐัะธะน',
    'PACK_10',
    '10 ัะตััะธะน ั ะผะฐะบัะธะผะฐะปัะฝะพะน ัะบะธะดะบะพะน. ะญะบะพะฝะพะผะธั 10000โฝ',
    40000, true, true, 10, 3, false, 20, true, 10, 10, 'ะัััะตะต ะฟัะตะดะปะพะถะตะฝะธะต! ะกะบะธะดะบะฐ 20%'
  )
ON CONFLICT DO NOTHING;
```

## ะจะฐะณ 2: ะะตัะตะทะฐะฟัััะธัะต dev ัะตัะฒะตั

```bash
# ะััะฐะฝะพะฒะธัะต ัะตะบััะธะน ัะตัะฒะตั (Ctrl+C)
# ะะฐะฟัััะธัะต ะทะฐะฝะพะฒะพ
npm run dev
```

## ะจะฐะณ 3: ะัะบัะพะนัะต ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั

1. ะะฐะนะดะธัะต ะบะฐะบ ะฐะดะผะธะฝ: http://localhost:3000/login
2. ะัะบัะพะนัะต ะฟัะพะดัะบัั: http://localhost:3000/admin/products

---

## ๐ ะกะธััะตะผะฐ ัะบะธะดะพะบ

### A) ะะพััะพัะฝะฝะฐั ัะบะธะดะบะฐ 10% ะดะปั ะปัะณะพัะฝัั ะบะฐัะตะณะพัะธะน

ะัะธ ัะพะทะดะฐะฝะธะธ/ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ ะฟัะพะดัะบัะฐ ะฒะบะปััะธัะต ะพะฟัะธั:
**"ะกะบะธะดะบะธ ะดะปั ะปัะณะพัะฝัั ะบะฐัะตะณะพัะธะน (10%)"**

ะญัะพ ะดะฐัั ัะบะธะดะบั ะดะปั:
- โฟ ะะฝะฒะฐะปะธะดะพะฒ
- ๐จโ๐ฉโ๐งโ๐ฆ ะะฝะพะณะพะดะตัะฝัั ัะตะผะตะน
- ๐ด ะะตะฝัะธะพะฝะตัะพะฒ
- ๐๏ธ ะฃัะฐััะฝะธะบะพะฒ ะกะะ

**ะะฐะถะฝะพ:** ะะปะธะตะฝั ะดะพะปะถะตะฝ ะฑัะดะตั ะฟะพะดัะฒะตัะดะธัั ัะฒะพั ะบะฐัะตะณะพัะธั ะฟัะธ ะพะฟะปะฐัะต (ะดะพะบัะผะตะฝัั).

### B) ะกะบะธะดะบะฐ 10% ะฟัะธ ะพะฟะปะฐัะต ะพั 10 ัะตััะธะน

ะัะธ ัะพะทะดะฐะฝะธะธ/ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ ะฟัะพะดัะบัะฐ ะทะฐะฟะพะปะฝะธัะต:
- **ะะธะฝะธะผัะผ ัะตััะธะน**: 10
- **ะัะพัะตะฝั ัะบะธะดะบะธ**: 10

ะญัะฐ ัะบะธะดะบะฐ ะฟัะธะผะตะฝัะตััั **ะฐะฒัะพะผะฐัะธัะตัะบะธ** ะฟัะธ ะตะดะธะฝะพะฒัะตะผะตะฝะฝะพะน ะพะฟะปะฐัะต ัะบะฐะทะฐะฝะฝะพะณะพ ะบะพะปะธัะตััะฒะฐ ัะตััะธะน.

### ะัะธะผะตั ะบะพะผะฑะธะฝะธัะพะฒะฐะฝะธั ัะบะธะดะพะบ:

**ะัะพะดัะบั:** "ะะฐะบะตั 10 ะบะพะฝััะปััะฐัะธะน"
- ะะฐะทะพะฒะฐั ัะตะฝะฐ: 50,000โฝ
- ะะฐะทะพะฒะฐั ัะบะธะดะบะฐ ะฝะฐ ะฟะฐะบะตั: 20% โ 40,000โฝ
- ะกะบะธะดะบะฐ ะดะปั ะปัะณะพัะฝะธะบะพะฒ: 10% โ 36,000โฝ
- ะะฐััะพะฒะฐั ัะบะธะดะบะฐ (ะพั 10 ัะตััะธะน): 10% โ ัะถะต ะฒะบะปััะตะฝะฐ

**ะัะพะณะพ:** 36,000โฝ (ัะบะพะฝะพะผะธั 14,000โฝ)

---

## ๐ฏ ะขะธะฟั ะฟัะพะดัะบัะพะฒ

### 1. ะะดะธะฝะพัะฝะฐั ัะตััะธั
```
ะะฐะทะฒะฐะฝะธะต: "ะะดะฝะฐ ะบะพะฝััะปััะฐัะธั"
SKU: SINGLE
ะฆะตะฝะฐ: 5,000โฝ
ะะฐะบะตั: ะะะข
ะกะตััะธะน: 1
```

### 2. ะะฐะบะตั ัะตััะธะน
```
ะะฐะทะฒะฐะฝะธะต: "ะะฐะบะตั 5 ะบะพะฝััะปััะฐัะธะน"
SKU: PACK_5
ะฆะตะฝะฐ: 22,500โฝ
ะะฐะบะตั: ะะ
ะกะตััะธะน: 5
ะะฐะทะพะฒะฐั ัะบะธะดะบะฐ: 10%
```

### 3. ะกะฟะตัะธะฐะปัะฝะพะต ะฟัะตะดะปะพะถะตะฝะธะต
```
ะะฐะทะฒะฐะฝะธะต: "ะะฐะบะตั 10 ะบะพะฝััะปััะฐัะธะน"
SKU: PACK_10
ะฆะตะฝะฐ: 40,000โฝ
ะะฐะบะตั: ะะ
ะกะตััะธะน: 10
ะะฐะทะพะฒะฐั ัะบะธะดะบะฐ: 20%
ะัะณะพัะฝัะต ะบะฐัะตะณะพัะธะธ: ะะ (10%)
ะะฐััะพะฒะฐั ัะบะธะดะบะฐ: ะพั 10 ัะตััะธะน (10%)
ะขะตะบัั ะฐะบัะธะธ: "ะัััะตะต ะฟัะตะดะปะพะถะตะฝะธะต! ะกะบะธะดะบะฐ 20%"
ะะตะบะพะผะตะฝะดัะตะผัะน: ะะ
```

---

## ๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ

### ะะฐัััะพะนะบะฐ ัะตะบะพะผะตะฝะดัะตะผะพะณะพ ะฟัะพะดัะบัะฐ:

ะัะผะตัััะต ะพะดะธะฝ ะฟัะพะดัะบั ะบะฐะบ **"ะะตะบะพะผะตะฝะดัะตะผัะน"** (Featured):
- ะะฝ ะฑัะดะตั ะฟะพะบะฐะทะฐะฝ ะฟะตัะฒัะผ ะฝะฐ ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัะต
- ะฃ ะฝะตะณะพ ะฑัะดะตั ะถะตะปัะฐั ะทะฒะตะทะดะพัะบะฐ
- ะะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒัะฑะตัะตััั ะฒ ัะพัะผะต ะฑัะพะฝะธัะพะฒะฐะฝะธั

### ะะพััะดะพะบ ะพัะพะฑัะฐะถะตะฝะธั:

ะัะฟะพะปัะทัะนัะต ะฟะพะปะต **"ะะพััะดะพะบ ัะพััะธัะพะฒะบะธ"**:
- 1 - ะฟะตัะฒัะน (ัะตะบะพะผะตะฝะดัะตะผัะน)
- 2 - ะฒัะพัะพะน
- 3 - ััะตัะธะน
- ะธ ั.ะด.

### ะะบัะธะธ ะธ ะฟัะพะผะพ:

ะัะฟะพะปัะทัะนัะต **"ะขะตะบัั ะฐะบัะธะธ"** ะดะปั:
- ะกะตะทะพะฝะฝัั ะฟัะตะดะปะพะถะตะฝะธะน
- ะะธะผะธัะธัะพะฒะฐะฝะฝัั ะฐะบัะธะน
- ะกะฟะตัะธะฐะปัะฝัั ััะปะพะฒะธะน

ะัะธะผะตัั:
- "ะกะบะธะดะบะฐ 15% ะดะพ ะบะพะฝัะฐ ัะฝะฒะฐัั!"
- "ะขะพะปัะบะพ ัะตะณะพะดะฝั: -20%"
- "ะัะธ ะฟะตัะฒะพะน ะทะฐะฟะธัะธ ัะบะธะดะบะฐ 500โฝ"

---

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ัััะตััะฒัััะธั ะฟัะพะดัะบัะพะฒ

ะัะปะธ ั ะฒะฐั ัะถะต ะตััั ะฟัะพะดัะบัั ะฒ ะะ:

```sql
-- ะะบะปััะธัั ะปัะณะพัะฝัะต ัะบะธะดะบะธ ะดะปั ะฒัะตั ะฟัะพะดัะบัะพะฒ
UPDATE public.products 
SET has_special_categories_discount = true;

-- ะะพะฑะฐะฒะธัั ะผะฐััะพะฒัั ัะบะธะดะบั ะดะปั ะฟะฐะบะตัะฐ 10
UPDATE public.products 
SET 
  bulk_discount_threshold = 10,
  bulk_discount_percent = 10,
  promo_text = 'ะกะบะธะดะบะฐ 10% ะฟัะธ ะพะฟะปะฐัะต ะพั 10 ัะตััะธะน'
WHERE sessions_count >= 10;
```

---

## ๐ฑ ะะฐะบ ััะพ ะฒัะณะปัะดะธั ะดะปั ะบะปะธะตะฝัะฐ

### ะะฐ ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัะต:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โญ ะะดะฝะฐ ะบะพะฝััะปััะฐัะธั       โ
โ                             โ
โ ะะฐะทะพะฒะฐั ัะตััะธั 60 ะผะธะฝัั     โ
โ                             โ
โ 5,000 โฝ                     โ
โ                             โ
โ ๐ ะกะบะธะดะบะธ ะดะปั ะปัะณะพัะฝะธะบะพะฒ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะ ัะพัะผะต ะฑัะพะฝะธัะพะฒะฐะฝะธั:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐะบะตั 10 ะบะพะฝััะปััะฐัะธะน       โ
โ                             โ
โ -20% ะกะบะธะดะบะฐ!                โ
โ                             โ
โ 40,000 โฝ  50,000 โฝ         โ
โ                             โ
โ ๐ ะกะบะธะดะบะธ ะดะปั ะปัะณะพัะฝะธะบะพะฒ    โ
โ ๐ ะกะบะธะดะบะฐ ะพั 10 ัะตััะธะน      โ
โ ๐ท๏ธ ะัััะตะต ะฟัะตะดะปะพะถะตะฝะธะต!      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ ะะพัะพะฒะพ!

ะขะตะฟะตัั ะพัะบัะพะนัะต:
- http://localhost:3000/admin/products - ัะฟัะฐะฒะปะตะฝะธะต ะฟัะพะดัะบัะฐะผะธ
- http://localhost:3000/ - ะฟะพัะผะพััะธัะต, ะบะฐะบ ะฒัะณะปัะดัั ะฟัะพะดัะบัั ะดะปั ะบะปะธะตะฝัะพะฒ
